version: "3"

env:
  DOCKER_REGISTRY: northamerica-northeast2-docker.pkg.dev/river-sonar-415120/backstage
  TAG: latest

tasks:
  dev:
    desc: Start backstage in dev mode
    dir: backstage
    cmds:
      - yarn dev
  
  build:
    desc: Builds Backstage using yarn
    dir: backstage
    cmds:
      - yarn build:all

  image:
    desc: Builds Backstage Docker image
    dir: backstage
    cmds:
      - docker image build . -f packages/backend/Dockerfile --tag $DOCKER_REGISTRY/backstage:$TAG

  publish:
    desc: Pushes Docker image to registry
    cmds:
      - docker push $DOCKER_REGISTRY/backstage:$TAG